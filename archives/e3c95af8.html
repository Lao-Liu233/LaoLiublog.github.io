<!DOCTYPE html>
<html lang="zh-hans">
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">

    

    <!--icon-->
    
        <link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/Lao-Liu233/blog_imgs/favicon.ico">
    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- meta -->
    
    <title>BGP初体验-Linux,Openwrt与Quagga | Lao_Liu Blog</title>
    
        <meta name="keywords" content="BGP,openwrt,quagga,zerotier,教程,鹤伞Ria, no">
    
    
        <meta name="description" content="Lao_Liu的BGP初体验。 -- Lao_Liu Blog">
    

    <!--Social link-->
     
        <meta name="twitter:card" content="summary_large_image ">
        
            <meta property="og:type" content="article">
        
        <meta property="og:locale" content="zh-hans">
        <meta property="og:site_name" content="Lao_Liu Blog>">
        <meta property="og:title" content="BGP初体验-Linux,Openwrt与Quagga | Lao_Liu Blog ">
        <meta property="og:description" content="Lao_Liu的BGP初体验。 -- Lao_Liu Blog ">
        <meta property="og:image" content>
     

    <!-- feed -->
    
        <link rel="alternate" href="/atom.xml" title="Lao_Liu Blog">
    

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@0.1/dist/css/style.min.css">
    
    
        
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@0.1/dist/css/github.min.css" crossorigin="anonymous" media="none" onload="this.media='all'">
        
    

    <!--LaTex-->
    

     

    
         
    
         
    

</head>

    <body>
        <div id="app">
            <header class="header">
    <div class="header__left">
        
            <a href="/" class="button">
                <span class="logo__text">
                    ← Lao_Liu Blog | 首页
                </span>
            </a>
        
    </div>
    <div class="header__right">
         
    </div>
</header>


            <main class="main">
    <div class="post-title">
    <h1 class="post-title__text">
        BGP初体验-Linux,Openwrt与Quagga
    </h1>
    <div class="post-meta">
        
            <a href="/archives/2020/02/" class="button" style="color: #808080;">
    2020-02-10
</a>
        
        
            
 
        
        
     
 

  
    </div>
</div>
<div class="post content-box">
    <div class="post__header">
        
             
        
    </div>
    <div class="post__content">
        <div class="markdown-body">
            <p>好久没写博客了！今天抽出点时间分享一下我的BGP初体验。</p>
<p>这一切的一切都要从一个叫鹤伞Ria的Vtuber说起……</p>
<a id="more"></a>

<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="操作环境"><a href="#操作环境" class="headerlink" title="操作环境"></a>操作环境</h3><p>Debian系Linux（其实是kali）：</p>
<p><code>sudo apt update &amp; sudo apt install quagga</code></p>
<p>Openwrt</p>
<p><code>opkg update &amp; opkg install quagga quagga-zebra quagga-bgpd quagga-vtysh</code></p>
<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p>采用Zerotier建立内网环境模拟真实网络。</p>
<p>Zerotier的安装及配置不再赘述，官网有详尽教程。</p>
<h2 id="网络环境"><a href="#网络环境" class="headerlink" title="网络环境"></a>网络环境</h2><p>本来想做三台设备两个AS间的通讯，有一台设备无法安装任何BGP软件也就作罢；也没有画拓扑图的必要了（悲）。</p>
<p>AS114514 Debian 10.0.1.1，命名为R1，享有10.0.1.0/24网段；</p>
<p>AS1919810 Openwrt 10.0.2.1，命名为R2，享有10.0.2.0/24网段。</p>
<h2 id="Quagga配置"><a href="#Quagga配置" class="headerlink" title="Quagga配置"></a>Quagga配置</h2><p>下面才是重头戏。Quagga的配置文件位于<code>/etc/quagga/</code></p>
<p>据测试，Openwrt安装quagga后会带有初始配置，而Debian不带初始配置，可自行创建。</p>
<p><code>/etc/quagga/zebra.conf</code>配置（可不用修改）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">! 登陆密码</span><br><span class="line">password zebra</span><br><span class="line">!</span><br><span class="line">access-list vty permit 127.0.0.0/8</span><br><span class="line">access-list vty deny any</span><br><span class="line">!</span><br><span class="line">line vty</span><br><span class="line"> access-class vty</span><br></pre></td></tr></table></figure>

<p><code>/etc/quagga/bgpd.conf</code>配置（需要根据情境修改）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">! 密码</span><br><span class="line">password zebra</span><br><span class="line">! AS号</span><br><span class="line">router bgp 114514</span><br><span class="line">! 本机公网（VPN网络）ip</span><br><span class="line"> bgp router-id 10.0.1.1</span><br><span class="line">! 本路由享有网段（需要交换的网段）</span><br><span class="line"> network 10.0.1.0/24</span><br><span class="line">! peer信息（建立连接的机器的公网（VPN网络）ip，AS及称呼）</span><br><span class="line"> neighbor 10.0.2.1 remote-as 1919810</span><br><span class="line"> neighbor 10.0.2.1 description R2</span><br></pre></td></tr></table></figure>

<p> 另一台机器的配置只需依葫芦画瓢，我就不再赘述。</p>
<p>配置之后，运行</p>
<p><code>/etc/init.d/zebra restart</code></p>
<p><code>/etc/init.d/bgpd restart</code>（Debian）</p>
<p>或者</p>
<p><code>/etc/init.d/quagga restart</code>（Openwrt）</p>
<p>重启quagga服务。</p>
<h2 id="欣赏结果"><a href="#欣赏结果" class="headerlink" title="欣赏结果"></a>欣赏结果</h2><p>忙活了这么久，终于能看到结果了！</p>
<p>运行</p>
<p><code>vtysh</code></p>
<p>进入quagga控制台（指令模拟Cisco，这块不大了解）</p>
<p>输入</p>
<p><code>show ip bgp neighbor</code></p>
<p>就会看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BGP neighbor is 10.0.2.1, remote AS 1919810, local AS 114514, external link</span><br><span class="line">Description: R2</span><br><span class="line">BGP version 4, remote router ID 10.0.2.1</span><br></pre></td></tr></table></figure>

<p>还有这么一张表</p>
<pre><code>                     Sent       Rcvd
Opens:                  2          0
Notifications:          0          0
Updates:                2          2
Keepalives:          1050       1049
Route Refresh:          0          0
Capability:             0          0
Total:               1054       1051</code></pre><p>再看看路由器内的活动ipv4路由表</p>
<table>
<thead>
<tr>
<th align="center">网络</th>
<th align="center">对象</th>
<th align="center">IPv4 网关</th>
<th align="center">跃点数</th>
<th align="center">表</th>
</tr>
</thead>
<tbody><tr>
<td align="center">xxx</td>
<td align="center">10.0.2.0/24</td>
<td align="center">10.0.2.1</td>
<td align="center">20</td>
<td align="center">main</td>
</tr>
</tbody></table>
<p>就算大功告成了！</p>
<h2 id="有什么用处呢？"><a href="#有什么用处呢？" class="headerlink" title="有什么用处呢？"></a>有什么用处呢？</h2><p><strong>没有。</strong></p>
<p>内网测试唯一能享受的就是看着这条无形的链接，想象自己也是网络工程师。</p>
<p>但是还是感觉很爽！</p>
<p>而且你已经学会（大概）了BGP，获取全球路由表也能办到了！</p>
<p>参考Ria的爸爸<del>（我的岳父）</del>的文章</p>
<p><a href="https://blog.foxsar.black/?p=246" rel="external nofollow noopener noreferrer" target="_blank">使用bird配置bgp网络互连</a></p>
<p>至于这一切与Ria有啥关系？欢迎关注Ria了解详情（滑稽）</p>
<p><a href="https://t.me/kanaria_group" rel="external nofollow noopener noreferrer" target="_blank">Telegram群组</a>  <a href="https://space.bilibili.com/2450927" rel="external nofollow noopener noreferrer" target="_blank">bilibli</a>  <a href="https://www.youtube.com/channel/UCC12ijOcPxnRSQPLvjWYXUg" rel="external nofollow noopener noreferrer" target="_blank">Youtube</a></p>

        </div>
    </div>
    
        
    <div class="post__license">
        <p>
            <strong>本文作者：Lao_Liu</strong>
        </p>
        
            <p>
                <strong>
                    <p>文章默认使用 <a href="https://raw.githubusercontent.com/Lao-Liu233/LaoLiublog.github.io/master/LICENSE" rel="external nofollow noopener noreferrer" target="_blank">MIT</a> 协议进行许可，使用时请注意遵守协议。</p>

                </strong>
            </p>
        
        
            <p>
                <strong>
                    本文链接：
                </strong>
                <a href="https://blog.laoliu.eu.org/archives/e3c95af8.html">https://blog.laoliu.eu.org/archives/e3c95af8.html</a>
            </p>
        
    </div>
 
    
    
        <div class="post-meta post-footer__meta">
    <p>
        最后更新于：2020-04-08
    </p>
</div> 
    
    
        <div class="post-cats post-card__cats">
    
</div>

<div class="post-tags post-card__tags">
    
        <a href="/tags/教程/" class="post-tags__link button"># 教程</a>
    
</div> 
     
</div>
<br>

    <div class="post__comment content-box">
        
    <h4 style="margin-top: 0;">评论</h4>
    
    
    
        <div id="gitalk-container"></div>
    
    
    
    
    


    </div>


</main>
<footer class="footer">
     


     
  
    
        
            <p>Copyright © 2020 </p>

        
            <p>Powered by <a href="https://hexo.io" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" rel="external nofollow noopener noreferrer" target="_blank">Cards</a></p>

        
    
</footer>


        </div>
        <!-- lazyload -->

    
        <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.min.js"></script>
    
    <script>
        window.lazyLoadOptions = {
            elements_selector: ".lazyload",
            threshold: 0
        };
    </script>


 

 

 

  

<!-- jQuery -->
 

<!-- fancybox -->
 

<!-- back to top -->
 


    
    
    
    
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
        <script>
            var gitalk = new Gitalk({
                clientID: "924b3db2d29629f6526b",
                clientSecret: "cdecc8febd3f52e490141f2b2d8036c1f31a2fca",
                repo: "LaoLiublog.github.io",
                owner: "Lao-Liu233",
                admin: "Lao-Liu233",
                id: window.location.pathname,
                distractionFreeMode: false
            });
            gitalk.render('gitalk-container');
        </script>
    
    
    
    
    
    
    

    


    </body>
</html>
